#!/usr/bin/env bash

# Generate API after download composer dev-requirements
NML_VERSION=$(git describe)

# Generate Api in: output/api
composer build-api

if [[ $? -ne 0 ]]; then
    echo 'Error! Unable to build documentation!'
    exit 1
fi

git checkout gh-pages

if [[ $? -ne 0 ]]; then
    echo 'Error! Unable to checkout branch!'
    exit 2
fi

# Clean current (old) api directory
rm -rf api

# Bring generated (new) api directory
cp -rf output/api/ api && rm -rf output/api

# Push generated files
git add --all api/
git commit -m ":arrow_up: Documentation (API ${NML_VERSION})."
git push

git checkout master
